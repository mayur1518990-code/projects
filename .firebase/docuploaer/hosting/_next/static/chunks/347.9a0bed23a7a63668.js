"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[347],{1347:(e,a,t)=>{t.r(a),t.d(a,{PaymentButton:()=>i});var r=t(4568),n=t(7620),o=t(3409);function i(e){let{amount:a,fileId:t,onSuccess:i,onError:s}=e,{user:l,loading:c}=(0,o.Z)(),[d,m]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(window.Razorpay)return void p(!0);let e=document.createElement("script");return e.src="https://checkout.razorpay.com/v1/checkout.js",e.async=!0,e.onload=()=>{p(!0)},e.onerror=e=>{null==s||s("Payment system unavailable. Please try again later.")},document.head.appendChild(e),()=>{e.parentNode&&e.parentNode.removeChild(e)}},[s]);let h=async()=>{if(c){null==s||s("Authentication is loading. Please wait...");return}if(!l){null==s||s("Please log in to make a payment");return}if(!u){null==s||s("Payment system is loading. Please try again in a moment.");return}m(!0);try{let e={key:"rzp_test_RJTmoYCxPGvgYd",amount:100*a,currency:"INR",name:"DocUpload",description:"Payment for file processing - ".concat(t||"Document"),handler:async e=>{let r=e.razorpay_order_id||"order_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,15));try{let n=await fetch("/api/payment/create-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileId:t,userId:l.userId,amount:a,razorpay_order_id:r,razorpay_payment_id:e.razorpay_payment_id,razorpay_signature:e.razorpay_signature||null,status:"captured"})});if(!n.ok){let e=await n.text();throw Error("Payment creation failed: ".concat(n.status," - ").concat(e))}let o=await n.json();if(!o.success)throw Error("Payment creation failed: ".concat(o.message));let s=await fetch("/api/files",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileId:t,userId:l.userId,status:"paid"})});await s.json(),null==i||i()}catch(e){null==i||i()}},prefill:{name:l.name||"User",email:l.email||"user@example.com",contact:l.phone||"9999999999"},notes:{file_id:t},theme:{color:"#2563eb"}};try{let a=new window.Razorpay(e);a.on("payment.failed",e=>{null==s||s(e.error.description||"Payment failed. Please try again.")}),a.open()}catch(a){let e=a instanceof Error?a.message:"Unknown error";null==s||s("Payment gateway initialization failed: ".concat(e))}}catch(e){null==s||s(e instanceof Error?e.message:"Payment failed. Please try again.")}finally{m(!1)}};return(0,r.jsx)("button",{onClick:h,disabled:d||!u||c||!l,className:"inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading..."]}):l?d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),"Pay â‚¹",a]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),"Login Required"]})})}}}]);