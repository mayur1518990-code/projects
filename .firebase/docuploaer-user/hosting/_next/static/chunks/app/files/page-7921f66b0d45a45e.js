(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[638],{441:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(4568),l=s(4271),r=s(241),n=s(7620);function i(e){let{response:t}=e,[s,l]=(0,n.useState)(!1);return(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,a.jsx)("h3",{className:"text-sm font-medium text-green-800",children:"Agent Response"}),t.agent&&(0,a.jsxs)("span",{className:"text-xs text-green-600",children:["by ",t.agent.name]})]}),(0,a.jsx)("button",{onClick:()=>l(!s),className:"text-green-600 hover:text-green-800 text-sm",children:s?"Hide":"View"})]}),s&&(0,a.jsxs)("div",{className:"mt-3 space-y-3",children:[t.message&&(0,a.jsx)("div",{className:"bg-white rounded-md p-3 border border-green-100",children:(0,a.jsx)("p",{className:"text-sm text-gray-700",children:t.message})}),t.responseFileURL&&(0,a.jsx)("div",{className:"bg-white rounded-md p-3 border border-green-100",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("span",{className:"text-2xl",children:(e=>{var t;switch(null==(t=e.split(".").pop())?void 0:t.toLowerCase()){case"pdf":return"\uD83D\uDCC4";case"doc":case"docx":return"\uD83D\uDCDD";case"jpg":case"jpeg":case"png":return"\uD83D\uDDBC️";default:return"\uD83D\uDCCE"}})(t.responseFileURL)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.responseFileURL.split("/").pop()||"Response File"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Response file from agent"})]}),(0,a.jsx)("a",{href:t.responseFileURL,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-3 py-1 border border-green-300 text-xs font-medium rounded-md text-green-700 bg-green-50 hover:bg-green-100 transition-colors",children:"Download"})]})}),(0,a.jsxs)("div",{className:"text-xs text-green-600",children:["Responded on ",new Date(t.respondedAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})}var d=s(3409),o=s(9664),c=s.n(o);function m(){let{user:e,loading:t}=(0,d.Z)(),[s,o]=(0,n.useState)([]),[m,x]=(0,n.useState)(!0),[u,h]=(0,n.useState)("all"),[g,p]=(0,n.useState)(""),f=(0,n.useRef)(!1),b=(0,n.useRef)(0),j=(0,n.useRef)([]),v=(0,n.useRef)(null),y=(0,n.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!e||f.current)return;let s=Date.now();if(!t&&j.current.length>0&&s-b.current<3e5){o(j.current),x(!1);return}try{let t;f.current=!0,x(!0),p("");let a=new AbortController,l=setTimeout(()=>a.abort(),1e4);try{t=await fetch("/api/files?userId=".concat(e.userId),{signal:a.signal,headers:{"Content-Type":"application/json"}})}catch(e){throw clearTimeout(l),e}if(clearTimeout(l),!t.ok)throw Error("HTTP ".concat(t.status,": ").concat(t.statusText));let r=await t.json();if(!r.success)throw Error(r.message||"Failed to load files");let n=r.files.map(e=>{var t;let s;switch(e.status){case"pending_payment":case"uploaded":default:s="pending_payment";break;case"paid":s="paid";break;case"processing":s="processing";break;case"completed":s="completed"}return{id:e.id,name:e.originalName,size:e.size,type:e.mimeType,status:s,uploadDate:new Date(e.uploadedAt),paymentAmount:100,qrCode:null==(t=e.metadata)?void 0:t.qrCode,agentResponse:e.agentResponse,hasResponse:e.hasResponse,agentId:e.agentId,assignedAt:e.assignedAt,respondedAt:e.respondedAt,processingStartedAt:e.processingStartedAt,completedAt:e.completedAt,completedFile:e.completedFile,completedFileId:e.completedFileId}});j.current=n,b.current=s,o(n)}catch(e){"AbortError"===e.name?p("Request timeout - please try again"):"TypeError"===e.name&&"Failed to fetch"===e.message?p("Unable to connect to server. Please check if the API is running."):p(e.message||"Failed to load files. Please try again.")}finally{x(!1),f.current=!1}},[e]);(0,n.useEffect)(()=>{!e||t||f.current||v.current!==e.userId&&(v.current=e.userId,y())},[e,t]),(0,n.useEffect)(()=>{let e=setTimeout(()=>{t&&console.warn("Auth loading timeout - proceeding without user")},5e3);return()=>clearTimeout(e)},[t]);let w=(0,n.useCallback)(e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},[]),N=(0,n.useCallback)(e=>e.includes("pdf")?(0,a.jsx)("svg",{className:"w-8 h-8 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z",clipRule:"evenodd"})}):e.includes("image")?(0,a.jsx)("svg",{className:"w-8 h-8 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}):(0,a.jsx)("svg",{className:"w-8 h-8 text-blue-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z",clipRule:"evenodd"})}),[]),k=(0,n.useCallback)(e=>{let t={pending_payment:{color:"bg-yellow-100 text-yellow-800",text:"Pending Payment"},pending:{color:"bg-yellow-100 text-yellow-800",text:"Pending Payment"},paid:{color:"bg-green-100 text-green-800",text:"Paid"},processing:{color:"bg-blue-100 text-blue-800",text:"Processing"},completed:{color:"bg-gray-100 text-gray-800",text:"Completed"}}[e];return(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(t.color),children:t.text})},[]),C=(0,n.useMemo)(()=>s.filter(e=>"all"===u||e.status===u),[s,u]),F=(0,n.useCallback)(()=>{y(!0)},[y]);(0,n.useEffect)(()=>{let e=e=>{"newFileUploaded"===e.key&&e.newValue&&(F(),localStorage.removeItem("newFileUploaded"))};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[F]);let L=(0,n.useCallback)(async t=>{if(!e||!confirm("Are you sure you want to delete this file?"))return;let a=[...s];o(e=>e.filter(e=>e.id!==t)),p("");try{let s=await fetch("/api/files?fileId=".concat(t,"&userId=").concat(e.userId),{method:"DELETE"}),l=await s.json();if(!l.success)throw o(a),Error(l.message||"Failed to delete file");j.current=j.current.filter(e=>e.id!==t)}catch(e){o(a),p(e.message||"Failed to delete file. Please try again.")}},[e,s]),R=(0,n.useCallback)(async(t,s)=>{if(e)try{p("");let l=await fetch("/api/files/completed/".concat(t,"/download?userId=").concat(e.userId));if(l.ok){var a;let e=l.headers.get("content-length"),t=(e&&parseInt(e,10),null==(a=l.body)?void 0:a.getReader());if(!t)throw Error("Failed to read file stream");let r=[];for(;;){let{done:e,value:s}=await t.read();if(e)break;r.push(s),s.length}let n=new Blob(r,{type:l.headers.get("content-type")||"application/octet-stream"}),i=window.URL.createObjectURL(n),d=document.createElement("a");d.href=i,d.download=s,d.style.display="none",document.body.appendChild(d),d.click(),setTimeout(()=>{window.URL.revokeObjectURL(i),document.body.removeChild(d)},100)}else throw Error("Download failed: ".concat(l.status," ").concat(l.statusText))}catch(e){p(e.message||"Failed to download completed file. Please try again.")}},[e]);return t?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):e?m?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-48 mb-6"}),(0,a.jsx)("div",{className:"space-y-4",children:[1,2,3].map(e=>(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gray-200 rounded"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/3 mb-2"}),(0,a.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/4"})]}),(0,a.jsx)("div",{className:"h-6 bg-gray-200 rounded w-20"})]})},e))})]})})})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"My Files"}),(0,a.jsx)(c(),{href:"/upload",className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Upload New File"})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex space-x-1",children:[{key:"all",label:"All Files"},{key:"pending_payment",label:"Pending Payment"},{key:"paid",label:"Paid"},{key:"processing",label:"Processing"},{key:"completed",label:"Completed"}].map(e=>(0,a.jsx)("button",{onClick:()=>h(e.key),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(u===e.key?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:e.label},e.key))}),(0,a.jsx)("div",{className:"flex space-x-2"})]})}),g&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-md mb-6",children:g}),0===C.length?(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,a.jsx)("p",{className:"text-gray-500 mb-4",children:"all"===u?"No files uploaded yet":"No ".concat(u," files")}),(0,a.jsx)(c(),{href:"/upload",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"Upload Your First Document"})]})}):(0,a.jsx)("div",{className:"space-y-4",children:C.map(e=>(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[N(e.type),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-1",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:w(e.size)}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e.uploadDate.toLocaleDateString()}),"processing"===e.status&&e.processingStartedAt&&(0,a.jsxs)("p",{className:"text-sm text-blue-600",children:["Processing since: ",new Date(e.processingStartedAt).toLocaleDateString()]}),"completed"===e.status&&e.completedAt&&(0,a.jsxs)("p",{className:"text-sm text-green-600",children:["Completed: ",new Date(e.completedAt).toLocaleDateString()]}),e.completedFile&&(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["by ",e.completedFile.agentName]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 ml-4",children:[k(e.status),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsxs)("span",{className:"text-lg font-semibold text-gray-900",children:["₹",e.paymentAmount]})})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3 pt-4 border-t border-gray-100",children:[(0,a.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:"pending_payment"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.x,{amount:e.paymentAmount,fileId:e.id,onSuccess:()=>{var t;return t=e.id,void(o(e=>e.map(e=>e.id===t?{...e,status:"paid"}:e)),j.current=j.current.map(e=>e.id===t?{...e,status:"paid"}:e))},onError:e=>p(e)}),(0,a.jsx)(l.X,{fileId:e.id,onGenerate:()=>{var t;return t=e.id,void o(e=>e.map(e=>e.id===t?{...e,qrCode:"generated"}:e))}})]})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(c(),{href:"/files/view/".concat(e.id),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors",children:[(0,a.jsxs)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]}),"completed"===e.status&&e.completedFile&&(0,a.jsxs)("button",{onClick:()=>R(e.completedFile.id,e.completedFile.originalName),className:"inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition-colors",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download Completed"]}),(0,a.jsxs)("button",{onClick:()=>L(e.id),className:"inline-flex items-center px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-lg hover:bg-red-700 transition-colors",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})]}),e.agentResponse&&(0,a.jsx)(i,{response:e.agentResponse})]})},e.id))}),(0,a.jsxs)("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:s.length}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Total Files"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:s.filter(e=>"pending_payment"===e.status).length}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Pending Payment"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-600",children:s.filter(e=>"paid"===e.status||"processing"===e.status||"completed"===e.status).length}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Paid"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:s.filter(e=>"completed"===e.status).length}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Completed"})]})]})]})})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Please log in to view your files"}),(0,a.jsx)("a",{href:"/login",className:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700",children:"Go to Login"})]})})}},1986:(e,t,s)=>{Promise.resolve().then(s.bind(s,441))}},e=>{e.O(0,[766,511,80,664,799,587,18,358],()=>e(e.s=1986)),_N_E=e.O()}]);